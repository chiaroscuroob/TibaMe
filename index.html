<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Product Scene Generator Pro</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #e4e4e7; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #d4d4d8; }
        .bg-grid-pattern { background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin 3s linear infinite; }
    </style>
</head>
<body class="bg-zinc-50 text-zinc-900 h-screen flex flex-col overflow-hidden selection:bg-zinc-900 selection:text-white">

    <!-- Header -->
    <header class="bg-white border-b border-zinc-200 h-16 flex-none z-30">
        <div class="max-w-[1600px] mx-auto px-6 h-full flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-zinc-900 rounded flex items-center justify-center text-white">
                    <i data-lucide="aperture" class="w-5 h-5"></i>
                </div>
                <span class="font-bold text-lg tracking-tight">StudioAI <span class="font-normal text-zinc-400">| Pro</span></span>
            </div>
            <div class="flex items-center gap-4">
                <span class="text-xs font-medium text-zinc-400 border px-2 py-1 rounded border-zinc-200 bg-zinc-50">v7.5 No-Cache</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-[1600px] mx-auto p-6 flex-1 w-full overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full">
            
            <!-- Left Panel -->
            <div class="lg:col-span-4 flex flex-col gap-6 overflow-y-auto pr-2 custom-scrollbar h-full pb-20">
                
                <!-- 1. Product Image -->
                <section class="space-y-2">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xs font-bold text-zinc-900 uppercase tracking-wider flex items-center gap-2">
                            <span class="w-5 h-5 rounded-full bg-zinc-900 text-white flex items-center justify-center text-[10px]">1</span>
                            商品原圖 (Product)
                        </h2>
                        <button id="clear-product-btn" class="text-[10px] text-zinc-400 hover:text-red-600 transition-colors hidden">清除</button>
                    </div>
                    <div id="product-upload-area" class="border border-dashed border-zinc-300 rounded-xl bg-white hover:bg-zinc-50 transition-all cursor-pointer h-32 flex flex-col items-center justify-center gap-2 group relative">
                        <input type="file" id="product-input" class="hidden" accept="image/*">
                        <div id="product-placeholder" class="flex flex-col items-center gap-2">
                            <i data-lucide="upload" class="w-6 h-6 text-zinc-400 group-hover:text-zinc-600 transition-colors"></i>
                            <span class="text-xs text-zinc-500 font-medium">上傳商品 (去背或白底佳)</span>
                        </div>
                        <div id="product-preview-container" class="absolute inset-0 w-full h-full hidden bg-white rounded-xl overflow-hidden border border-zinc-200">
                            <img id="product-img" class="w-full h-full object-contain p-2 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
                            <div id="product-analysis-overlay" class="absolute inset-0 bg-white/80 flex items-center justify-center hidden">
                                <div class="flex items-center gap-2 text-zinc-600 text-xs animate-pulse"><i data-lucide="scan-eye" class="w-4 h-4"></i> 正在辨識商品...</div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2 px-1">
                            <i data-lucide="tag" class="w-3 h-3 text-zinc-400"></i>
                            <input type="text" id="product-name" placeholder="這是什麼？(例如: 滷肉飯, 洗髮精)" class="flex-1 text-xs bg-transparent border-b border-zinc-200 focus:border-zinc-800 outline-none py-1 placeholder:text-zinc-300 font-medium text-zinc-800">
                        </div>
                        <div id="product-suggestions" class="flex flex-wrap gap-1.5 px-1"></div>
                    </div>
                </section>

                <!-- 2. Background Source -->
                <section class="space-y-3 pt-2 border-t border-zinc-100">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xs font-bold text-zinc-900 uppercase tracking-wider flex items-center gap-2">
                            <span class="w-5 h-5 rounded-full bg-zinc-900 text-white flex items-center justify-center text-[10px]">2</span>
                            背景來源設定 (Background)
                        </h2>
                    </div>
                    <div class="flex p-1 bg-zinc-100 rounded-lg">
                        <button id="mode-upload-btn" class="flex-1 flex items-center justify-center gap-2 py-2 rounded-md text-xs font-medium transition-all bg-white text-zinc-900 shadow-sm"><i data-lucide="image-plus" class="w-3 h-3"></i> 自訂圖片上傳</button>
                        <button id="mode-preset-btn" class="flex-1 flex items-center justify-center gap-2 py-2 rounded-md text-xs font-medium transition-all text-zinc-500 hover:text-zinc-700"><i data-lucide="layout" class="w-3 h-3"></i> AI 風格預設</button>
                    </div>

                    <!-- Upload Mode Content -->
                    <div id="upload-mode-content" class="space-y-3">
                        <div id="ref-upload-area" class="border border-dashed border-zinc-300 rounded-xl bg-white hover:bg-zinc-50 transition-all cursor-pointer h-32 flex flex-col items-center justify-center gap-1 group relative">
                             <input type="file" id="ref-input" class="hidden" accept="image/*">
                             <div id="ref-placeholder" class="flex flex-col items-center gap-1">
                                <i data-lucide="store" class="w-6 h-6 text-zinc-400 group-hover:text-zinc-600 transition-colors"></i>
                                <span class="text-xs text-zinc-500 font-medium">上傳參考圖片 (店景/風格圖)</span>
                             </div>
                             <div id="ref-preview-container" class="absolute inset-0 w-full h-full hidden bg-white rounded-xl overflow-hidden border border-zinc-300">
                                <img id="ref-img" class="w-full h-full object-contain p-1 bg-zinc-50">
                                <div class="absolute top-1 right-1 bg-zinc-900/70 text-white text-[10px] px-1.5 rounded">已上傳</div>
                                <button id="clear-ref-btn" class="absolute bottom-1 right-1 text-[10px] bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition-colors">移除</button>
                             </div>
                        </div>
                        <div id="upload-submode-container" class="bg-indigo-50 border border-indigo-100 p-2 rounded-lg hidden">
                            <label class="text-[10px] font-bold text-indigo-900 uppercase tracking-wider mb-1.5 block">此圖片用途 (Usage)</label>
                            <div class="flex gap-1">
                                <button id="submode-composite-btn" class="flex-1 flex flex-col items-center justify-center gap-1 py-2 px-1 rounded-md text-[10px] font-medium transition-all border bg-indigo-600 text-white border-indigo-600 shadow-sm">
                                    <div class="flex items-center gap-1"><i data-lucide="stamp" class="w-3 h-3"></i> 背景圖</div>
                                    <span class="text-[9px] opacity-80 font-normal scale-90">保留結構・直接合成</span>
                                </button>
                                <button id="submode-composition-btn" class="flex-1 flex flex-col items-center justify-center gap-1 py-2 px-1 rounded-md text-[10px] font-medium transition-all border bg-white text-zinc-500 border-zinc-200 hover:border-indigo-300">
                                    <div class="flex items-center gap-1"><i data-lucide="frame" class="w-3 h-3"></i> 參考構圖</div>
                                    <span class="text-[9px] opacity-80 font-normal scale-90">替換主體・模仿構圖</span>
                                </button>
                            </div>
                            <p id="submode-desc" class="text-[10px] text-indigo-800/70 mt-1.5 px-1 leading-tight">• 適合空景照片。AI 會保留照片中的桌子/空間，直接把商品放進去。</p>
                        </div>
                    </div>

                    <!-- Preset Mode Content -->
                    <div id="preset-mode-content" class="grid grid-cols-2 gap-2 hidden"></div>
                </section>

                <!-- 3. Generate -->
                <div class="mt-auto space-y-4 pt-4 border-t border-zinc-200">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider ml-1">補充提示詞 (Optional)</label>
                        <textarea id="custom-prompt" placeholder="例如: 增加一點桌面反光..." class="w-full p-3 text-sm border rounded-xl focus:ring-1 focus:ring-zinc-900 outline-none h-16 bg-white border-zinc-200 resize-none"></textarea>
                    </div>
                    <button id="generate-btn" disabled class="w-full h-12 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all shadow-lg transform active:scale-[0.98] bg-zinc-100 text-zinc-400 cursor-not-allowed">
                        <i data-lucide="rocket" class="w-4 h-4"></i><span id="generate-btn-text">生成預設場景 + 4視角</span>
                    </button>
                    <div id="error-msg" class="text-red-500 text-xs text-center hidden"></div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="lg:col-span-8 flex flex-col gap-6 h-full overflow-y-auto custom-scrollbar pb-6">
                <div class="bg-zinc-100 rounded-2xl border border-zinc-200 overflow-hidden relative shadow-inner flex flex-col w-full h-auto min-h-[400px] shrink-0 transition-all group">
                    <div class="h-12 bg-white border-b border-zinc-200 flex items-center justify-between px-4 sticky top-0 z-10 shrink-0">
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-bold text-zinc-800 uppercase tracking-wider flex items-center gap-1"><i data-lucide="sparkles" class="w-3 h-3 text-amber-500"></i><span id="preview-title">AI Preview</span></span>
                        </div>
                        <div class="flex gap-2">
                            <button id="download-main-btn" class="flex items-center gap-1 px-3 py-1 bg-zinc-900 text-white text-xs rounded hover:bg-zinc-800 hidden"><i data-lucide="download" class="w-3 h-3"></i> 下載</button>
                        </div>
                    </div>
                    <div class="flex-1 relative flex items-center justify-center p-4 bg-zinc-50/50 overflow-hidden min-h-[400px]">
                        <div class="absolute inset-0 opacity-[0.5] pointer-events-none bg-grid-pattern"></div>
                        <div id="preview-empty" class="text-center text-zinc-400 relative z-10">
                            <div class="w-16 h-16 bg-zinc-100 rounded-full flex items-center justify-center mx-auto mb-3 border border-zinc-200"><i data-lucide="monitor" class="w-6 h-6 text-zinc-300"></i></div>
                            <p class="text-sm font-medium">準備就緒</p><p class="text-xs mt-1 text-zinc-400">等待指令中...</p>
                        </div>
                        <div id="preview-loading" class="flex flex-col items-center justify-center text-zinc-500 gap-3 relative z-10 hidden">
                            <div class="w-12 h-12 border-4 border-zinc-300 border-t-zinc-900 rounded-full animate-spin"></div>
                            <div class="text-center"><p class="text-sm font-bold text-zinc-800">正在生成中...</p><p class="text-xs text-zinc-400 mt-1">AI 正在計算光影與透視</p></div>
                        </div>
                        <img id="main-result-img" class="w-auto h-auto max-w-full max-h-full object-contain shadow-2xl rounded-lg bg-white hidden relative z-10">
                    </div>
                </div>
                <div id="variations-section" class="space-y-3 pb-10 hidden">
                    <h3 class="text-sm font-bold text-zinc-700 flex items-center gap-2 px-1"><i data-lucide="grid" class="w-4 h-4"></i> 多視角變體 (Variations)</h3>
                    <div id="variations-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- 關鍵修改：加上時間戳記，強迫瀏覽器讀取新檔案 -->
    <script src="script.js?v=force_reload_75"></script>
</body>
</html>
